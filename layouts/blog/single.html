{{ define "main" }}
<div class="td-content" style="max-width: 100%; padding: 0 15px;">
  <div class="container-fluid px-0">
    <div class="row g-4 justify-content-center">
      <!-- Left Sidebar - Categories -->
      <aside class="col-12 col-xl-2 d-none d-xl-block position-sticky" style="top: 1rem; align-self: flex-start;">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0"><i class="fas fa-folder-open me-2"></i>Categories</h5>
          </div>
          <div class="card-body py-2">
            {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
              <a href="{{ "/categories/" | relLangURL }}{{ $name | urlize }}" 
                 class="d-block py-2 text-decoration-none text-muted hover-text-primary">
                <i class="fas fa-folder me-2"></i>{{ $name | title }} ({{ $taxonomy.Count }})
              </a>
            {{ end }}
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="col-12 col-xl-8">
        <article class="card shadow-sm border-0">
          <div class="card-body p-4 p-md-5">
            <!-- Header -->
            <header class="mb-4">
              <h1 class="display-4 fw-bold mb-3">{{ .Title }}</h1>
              <div class="d-flex flex-wrap align-items-center text-muted mb-4">
                <div class="d-flex align-items-center me-4 mb-2">
                  <i class="far fa-calendar-alt me-2"></i>
                  <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
                </div>
                {{ with .Params.categories }}
                <div class="d-flex flex-wrap align-items-center">
                  <i class="fas fa-tags me-2"></i>
                  {{ range $index, $category := . }}
                  <a href="{{ "/categories/" | relURL }}{{ $category | urlize }}" 
                    class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2">
                    {{ $category }}
                  </a>
                  {{ end }}
                </div>
                {{ end }}
              </div>
            </header>

            <!-- Content -->
            <div class="blog-content">
              {{ .Content }}
            </div>
          </div>

          <!-- Footer with navigation and tags -->
          <div class="card-footer bg-transparent border-top-0 py-3">
            <!-- Tags -->
            {{ if .Params.tags }}
            <div class="mb-4">
              <h6 class="mb-2"><i class="fas fa-tags me-2"></i>Tags</h6>
              <div class="d-flex flex-wrap gap-2">
                {{ range .Params.tags }}
                <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" 
                  class="badge bg-light text-dark text-decoration-none border">
                  #{{ . }}
                </a>
                {{ end }}
              </div>
            </div>
            {{ end }}

            <!-- Author and date -->
            <div class="d-flex justify-content-between align-items-center text-muted small mb-4">
              <div>
                {{ if .Site.Params.author }}
                <span><i class="fas fa-user me-1"></i> {{ .Site.Params.author }}</span>
                {{ end }}
              </div>
              <div>
                <i class="far fa-calendar-alt me-1"></i>
                <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
              </div>
            </div>

            <!-- Navigation -->
            <div class="d-flex justify-content-between align-items-center pt-3 border-top">
              <div>
                {{ with .PrevInSection }}
                <a href="{{ .RelPermalink }}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-arrow-left me-2"></i> Previous
                </a>
                {{ end }}
              </div>
              <div>
                {{ with .NextInSection }}
                <a href="{{ .RelPermalink }}" class="btn btn-sm btn-outline-primary">
                  Next <i class="fas fa-arrow-right ms-2"></i>
                </a>
                {{ end }}
              </div>
            </div>
          </div>
        </article>
      </div>

      <!-- Right Sidebar - Tags and Recent Posts -->
      <aside class="col-12 col-xl-2 d-none d-xl-block position-sticky" style="top: 1rem; align-self: flex-start;">
        <!-- Popular Tags -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0"><i class="fas fa-hashtag me-2"></i>Popular Tags</h5>
          </div>
          <div class="card-body py-3">
            <div class="d-flex flex-wrap gap-2">
              {{ range first 20 .Site.Taxonomies.tags.ByCount }}
                <a href="{{ "/tags/" | relLangURL }}{{ .Name | urlize }}" 
                  class="badge bg-light text-dark text-decoration-none border">
                  #{{ .Name }} ({{ .Count }})
                </a>
              {{ end }}
            </div>
          </div>
        </div>

        <!-- Recent Posts -->
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0 py-3">
            <h5 class="mb-0"><i class="far fa-clock me-2"></i>Recent Posts</h5>
          </div>
          <div class="card-body py-2">
            {{ $recent := where .Site.RegularPages "Type" "blog" | first 5 }}
            {{ range $recent }}
              <a href="{{ .RelPermalink }}" class="d-block py-2 text-decoration-none text-muted hover-text-primary">
                <div class="d-flex align-items-center">
                  {{ if .Params.image }}
                    <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}" class="rounded me-2" style="width: 50px; height: 50px; object-fit: cover;">
                  {{ end }}
                  <div>
                    <div class="fw-medium text-dark">{{ .Title }}</div>
                    <small class="text-muted">{{ .Date.Format "Jan 2, 2006" }}</small>
                  </div>
                </div>
              </a>
            {{ end }}
          </div>
        </div>
      </aside>
    </div>
  </div>
  
  <!-- Related Posts Section -->
  <div class="container-fluid mt-5">
    <div class="row justify-content-center">
      <div class="col-12 col-xl-8">
        <h3 class="mb-4">Related Posts</h3>
        <div class="row g-4">
          {{ $related := .Site.RegularPages.Related . | first 3 }}
          {{ range $related }}
          <div class="col-md-4">
            <div class="card h-100">
              {{ if .Params.image }}
              <img src="{{ .Params.image | relURL }}" class="card-img-top" alt="{{ .Title }}" style="height: 180px; object-fit: cover;">
              {{ end }}
              <div class="card-body">
                <h5 class="card-title">{{ .Title }}</h5>
                <p class="card-text text-muted small">{{ .Date.Format "January 2, 2006" }}</p>
                <a href="{{ .RelPermalink }}" class="btn btn-outline-primary btn-sm">Read More</a>
              </div>
            </div>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom CSS for the blog layout -->
<style>
  .position-sticky {
    position: -webkit-sticky;
    position: sticky;
  }
  
  .hover-text-primary:hover {
    color: var(--bs-primary) !important;
  }
  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    margin-bottom: 1.5rem;
  }
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.05) !important;
  }
  .blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 1.5rem 0;
  }
  .blog-content h2, 
  .blog-content h3, 
  .blog-content h4, 
  .blog-content h5, 
  .blog-content h6 {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .blog-content p {
    margin-bottom: 1.2rem;
    line-height: 1.7;
  }
</style>

<!-- Custom Styles for Blog Content -->
<style>
  /* Ensure proper spacing and typography */
  .blog-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #2d3748;
  }
  
  .blog-content p {
    margin-bottom: 1.5rem;
  }
  
  .blog-content h1,
  .blog-content h2, 
  .blog-content h3, 
  .blog-content h4, 
  .blog-content h5, 
  .blog-content h6 {
    margin-top: 2rem;
    margin-bottom: 1.5rem;
    font-weight: 600;
    color: #1a202c;
  }
  
  .blog-content h1 { font-size: 2.25rem; }
  .blog-content h2 { font-size: 1.875rem; }
  .blog-content h3 { font-size: 1.5rem; }
  .blog-content h4 { font-size: 1.25rem; }
  
  /* Style code blocks */
  .blog-content pre {
    background-color: #1e1e1e;
    border-radius: 0.5rem;
    padding: 1.25rem;
    margin: 1.5rem 0;
    overflow-x: auto;
  }
  
  .blog-content code {
    font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.9em;
    color: #e2e8f0;
    background-color: transparent;
  }
  
  .blog-content pre code {
    padding: 0;
    background-color: transparent;
  }
  
  /* Style tables */
  .blog-content table {
    width: 100%;
    margin: 1.5rem 0;
    border-collapse: collapse;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }
  
  .blog-content th,
  .blog-content td {
    padding: 0.75rem 1rem;
    border: 1px solid #e2e8f0;
  }
  
  .blog-content th {
    background-color: #f8f9fa;
    font-weight: 600;
    text-align: left;
  }
  
  .blog-content tr:nth-child(even) {
    background-color: #f8f9fa;
  }
  
  /* Style blockquotes */
  .blog-content blockquote {
    border-left: 4px solid #0d6efd;
    padding: 0.5rem 1rem;
    margin: 1.5rem 0;
    background-color: #f8f9fa;
    font-style: italic;
  }
  
  /* Style images */
  .blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 1.5rem 0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .blog-content {
      font-size: 1rem;
    }
    
    .blog-content h1 { font-size: 1.75rem; }
    .blog-content h2 { font-size: 1.5rem; }
    .blog-content h3 { font-size: 1.25rem; }
    
    .blog-content pre {
      border-radius: 0;
      margin-left: -1rem;
      margin-right: -1rem;
      padding: 1rem;
    }
  }
</style>
{{ end }}
