{{ $scssMain := "scss/main.scss" -}}
{{ $css := resources.Get $scssMain | toCSS (dict "enableSourceMap" (not hugo.IsProduction)) -}}

{{/* Skip PostCSS processing to avoid dependency issues */ -}}

{{ if hugo.IsProduction -}}
  {{ $css = $css | minify | fingerprint -}}
  <link rel="preload" href="{{ $css.RelPermalink }}" as="style" integrity="{{ $css.Data.Integrity }}" crossorigin="anonymous">
{{ end -}}

{{ with $css -}}
  <link href="{{ .RelPermalink }}" rel="stylesheet"
  {{- with .Data.Integrity }} integrity="{{ . }}" crossorigin="anonymous"{{ end -}}
  >
{{ else -}}
  {{ errorf "Resource not found or error building CSS: %s" $scssMain -}}
{{ end -}}