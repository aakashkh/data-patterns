{{ define "main" }}
<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="text-center mb-5">
        <h1 class="display-4 mb-3">{{ .Title }}</h1>
        <p class="lead text-muted">{{ .Description }}</p>
      </div>
      
      {{ .Content }}
      
      <!-- Latest Blog Posts -->
      <section class="my-5 py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h4 mb-0">Latest Blog Posts</h2>
          <a href="/data-patterns/blog/" class="btn btn-sm btn-outline-primary">View All Posts <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
        
        <div class="row g-4">
          {{ range first 3 (where .Site.RegularPages "Section" "blog").ByDate.Reverse }}
          <div class="col-md-4">
            <article class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <span class="badge bg-primary bg-opacity-10 text-primary me-2">
                    {{ .ReadingTime }} min read
                  </span>
                  <small class="text-muted">{{ .Date.Format "Jan 2, 2006" }}</small>
                </div>
                <h3 class="h5 card-title mb-3">
                  <a href="{{ .RelPermalink }}" class="text-dark text-decoration-none">{{ .Title }}</a>
                </h3>
                <p class="card-text text-muted small">
                  {{ with .Description }}
                    {{ . }}
                  {{ else }}
                    {{ .Summary | plainify | truncate 120 }}
                  {{ end }}
                </p>
                {{ with .Params.categories }}
                <div class="mt-3">
                  {{ range . }}
                    <a href="/data-patterns/categories/{{ . | urlize }}" class="badge bg-light text-dark text-decoration-none me-1">{{ . }}</a>
                  {{ end }}
                </div>
                {{ end }}
              </div>
              <div class="card-footer bg-transparent border-0 pt-0">
                <a href="{{ .RelPermalink }}" class="btn btn-sm btn-link text-primary p-0">
                  Read more <i class="fas fa-arrow-right ms-1"></i>
                </a>
              </div>
            </article>
          </div>
          {{ end }}
        </div>
      </section>
      
      <!-- Categories Section -->
<section class="mt-5">
  <h2 class="mb-4">Browse by Category</h2>
  <div class="row g-4">
    {{ if .Site.Taxonomies.categories }}
      {{ $categoryIcons := dict
        "python" "python"
        "pandas" "table"
        "spark" "fire"
        "pyspark" "fire"
        "r" "r-project"
        "rstudio" "r-project"
        "Powerbi" "chart-line"
        "power-bi" "chart-line"
        "power-query" "filter"
        "dax" "calculator"
        "business-intelligence" "chart-bar"
        "bi" "chart-bar"
        "Tsql" "code"
        "mssql" "database"
        "sql-server" "server"
        "sql" "database"
        "data-science" "flask"
        "machine-learning" "robot"
        "ml" "brain"
        "ai" "microchip"
        "tutorial" "graduation-cap"
        "development" "code-branch"
        "azure" "microsoft"
        "azure-data-factory" "sitemap"
        "adf" "sitemap"
        "aws" "aws"
        "gcp" "google"
        "docker" "docker"
        "kubernetes" "dharmachakra"
        "database" "database"
        "nosql" "server"
        "devops" "code-merge"
        "ci-cd" "sync"
        "automation" "robot"
        "best-practices" "star"
        "performance" "tachometer-alt"
        "analytics" "chart-pie"
        "data-engineering" "project-diagram"
        "etl" "exchange-alt"
        "jupyter" "book"
        "notebook" "book-open"
        "duckdb" "database"
        "polars" "snowflake"
        "git" "git-alt"
        "github" "github"
        "mlops" "cogs"
        "fabric" "microsoft"
        "data-pipeline" "stream"
      }}
      
      {{ $sortedCategories := slice }}
      {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
        {{ with $.Site.GetPage (printf "/categories/%s" $name) }}
          {{ $sortedCategories = $sortedCategories | append (dict "page" . "count" $taxonomy.Count "name" $name) }}
        {{ end }}
      {{ end }}

      {{ range sort $sortedCategories "count" "desc" }}
        {{ $icon := index $categoryIcons (lower .name) | default "folder" }}
        <div class="col-md-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body text-center">
              <div class="icon-wrapper mb-3">
                <i class="fab fa-{{ $icon }} fa-2x text-primary"></i>
              </div>
              <h3 class="h5 card-title mb-2">
                <a href="{{ .page.RelPermalink }}" class="text-decoration-none text-dark">
                  {{ .page.LinkTitle | title }}
                </a>
              </h3>
              <p class="text-muted mb-0">
                {{ .count }} {{ if eq .count 1 }}post{{ else }}posts{{ end }}
              </p>
            </div>
          </div>
        </div>
      {{ end }}
    {{ else }}
      <div class="col-12">
        <div class="text-center py-5">
          <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
          <p class="text-muted">No categories found.</p>
        </div>
      </div>
    {{ end }}
  </div>
</section>

<!-- Category Icons CSS -->
<style>
  .icon-wrapper {
    width: 60px;
    height: 60px;
    margin: 0 auto 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(var(--bs-primary-rgb), 0.1);
    border-radius: 50%;
    transition: all 0.3s ease;
  }
  
  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid rgba(0, 0, 0, 0.08);
  }
  
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
    border-color: rgba(var(--bs-primary-rgb), 0.3);
  }
  
  .card:hover .icon-wrapper {
    background-color: rgba(var(--bs-primary-rgb), 0.2);
    transform: scale(1.1);
  }
  
  .card:hover .icon-wrapper i {
    transform: rotate(5deg);
  }
  
  .card-title a {
    transition: color 0.2s ease;
  }
  
  .card:hover .card-title a {
    color: var(--bs-primary) !important;
  }
</style>

    </div>
  </div>
</main>
{{ end }}
